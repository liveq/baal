<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³„ìë¦¬ ê¶í•© ì§ì ‘ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #1a1a2e;
            color: #fff;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #16213e;
            border-radius: 10px;
        }
        .test-result {
            background-color: #0f3460;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #e94560;
        }
        .success { border-left-color: #4CAF50; }
        .warning { border-left-color: #FF9800; }
        .error { border-left-color: #f44336; }
        .zodiac-names {
            font-weight: bold;
            color: #e94560;
            font-size: 1.2em;
        }
        .message-text {
            background-color: #0a1e2e;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-style: italic;
            line-height: 1.6;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .stat {
            background-color: #0a1e2e;
            padding: 8px 12px;
            border-radius: 5px;
            margin: 2px;
        }
        button {
            background-color: #e94560;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #d73c56;
        }
        .log {
            background-color: #000;
            color: #0f0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .summary {
            background-color: #2c1810;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ ë³„ìë¦¬ ê¶í•© ì§ì ‘ í…ŒìŠ¤íŠ¸ - ìµœì¢… ê²€ì¦</h1>

        <div>
            <h2>ğŸ” í…ŒìŠ¤íŠ¸ ì‹¤í–‰</h2>
            <button onclick="runAllTests()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button onclick="testSpecificPairs()">íŠ¹ì • ì¡°í•© í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
        </div>

        <div id="summary"></div>
        <div id="results"></div>
        <div id="console-log" class="log"></div>
    </div>

    <script>
        // ì½˜ì†” ë¡œê·¸ ìº¡ì²˜
        const originalLog = console.log;
        const originalError = console.error;
        const logDiv = document.getElementById('console-log');

        function captureLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44336' : '#4CAF50';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            captureLog(args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            captureLog(args.join(' '), 'error');
        };

        const resultsDiv = document.getElementById('results');
        const summaryDiv = document.getElementById('summary');

        function addResult(title, content, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<h3>${title}</h3>${content}`;
            resultsDiv.appendChild(div);
        }

        function addSummary(content) {
            summaryDiv.innerHTML = `<div class="summary"><h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ìš”ì•½</h3>${content}</div>`;
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
            logDiv.innerHTML = '';
            summaryDiv.innerHTML = '';
        }

        // ë³„ìë¦¬ ì´ë¦„ ë§¤í•‘
        const zodiacNames = {
            1: 'ì–‘ìë¦¬', 2: 'í™©ì†Œìë¦¬', 3: 'ìŒë‘¥ì´ìë¦¬', 4: 'ê²Œìë¦¬',
            5: 'ì‚¬ììë¦¬', 6: 'ì²˜ë…€ìë¦¬', 7: 'ì²œì¹­ìë¦¬', 8: 'ì „ê°ˆìë¦¬',
            9: 'ì‚¬ìˆ˜ìë¦¬', 10: 'ì—¼ì†Œìë¦¬', 11: 'ë¬¼ë³‘ìë¦¬', 12: 'ë¬¼ê³ ê¸°ìë¦¬'
        };

        // compatibility-data.json ë°ì´í„° ì§ì ‘ ë¡œë“œ
        async function loadCompatibilityData() {
            try {
                // ê²½ë¡œ ìˆ˜ì • - í˜„ì¬ í…ŒìŠ¤íŠ¸ íŒŒì¼ì´ ë£¨íŠ¸ì— ìˆìœ¼ë¯€ë¡œ
                console.log('JSON íŒŒì¼ ë¡œë“œ ì‹œë„...');
                const response = await fetch('./zodiac-system/api/compatibility-data.json');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log(`âœ… JSON ë¡œë“œ ì„±ê³µ: ${Object.keys(data).length}ê°œ í•­ëª©`);
                return data;
            } catch (error) {
                console.error('âŒ JSON ë¡œë“œ ì‹¤íŒ¨:', error.message);
                return null;
            }
        }

        // ê¶í•© í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        async function testCompatibility(z1, z2, compatData) {
            const minId = Math.min(z1, z2);
            const maxId = Math.max(z1, z2);
            const key = `${minId}-${maxId}`;

            console.log(`ğŸ¯ í…ŒìŠ¤íŠ¸: ${zodiacNames[z1]} Ã— ${zodiacNames[z2]} (${key})`);

            if (compatData && compatData[key]) {
                const item = compatData[key];

                return {
                    zodiac1: zodiacNames[z1],
                    zodiac2: zodiacNames[z2],
                    key: key,
                    totalScore: item.overall_score,
                    scores: {
                        love: item.love_score,
                        friendship: item.friendship_score,
                        work: item.work_score
                    },
                    message: item.compat_message,
                    messageLength: item.compat_message ? item.compat_message.length : 0,
                    advice: item.advice,
                    source: 'compatibility-data.json'
                };
            } else {
                console.log(`âŒ ë°ì´í„° ì—†ìŒ: ${key}`);
                return {
                    zodiac1: zodiacNames[z1],
                    zodiac2: zodiacNames[z2],
                    key: key,
                    error: 'No data found',
                    source: 'error'
                };
            }
        }

        // íŠ¹ì • ì¡°í•© í…ŒìŠ¤íŠ¸
        async function testSpecificPairs() {
            console.log('ğŸ¯ íŠ¹ì • ì¡°í•© í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            const compatData = await loadCompatibilityData();
            if (!compatData) {
                addResult('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨', 'compatibility-data.jsonì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const testCases = [
                {name: 'ì–‘ìë¦¬ - ê²Œìë¦¬ (ë¬¸ì œ ì¡°í•©)', z1: 1, z2: 4},
                {name: 'ì‚¬ììë¦¬ - ì‚¬ììë¦¬ (ë™ì¼ ë³„ìë¦¬)', z1: 5, z2: 5},
                {name: 'ì–‘ìë¦¬ - í™©ì†Œìë¦¬ (ì¼ë°˜ ì¡°í•©)', z1: 1, z2: 2},
                {name: 'ë¬¼ê³ ê¸°ìë¦¬ - ì–‘ìë¦¬ (ì—­ìˆœ)', z1: 12, z2: 1},
                {name: 'ì²œì¹­ìë¦¬ - ì „ê°ˆìë¦¬', z1: 7, z2: 8}
            ];

            for (const testCase of testCases) {
                const result = await testCompatibility(testCase.z1, testCase.z2, compatData);

                if (result.error) {
                    addResult(`âŒ ${testCase.name}`, `ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${result.key}`, 'error');
                } else {
                    const lengthStatus = (result.messageLength >= 150 && result.messageLength <= 500) ? 'success' : 'warning';

                    addResult(`${testCase.name}`, `
                        <div class="zodiac-names">${result.zodiac1} Ã— ${result.zodiac2}</div>
                        <div class="stats">
                            <span class="stat">ì „ì²´: ${result.totalScore}ì </span>
                            <span class="stat">ì• ì •: ${result.scores.love}ì </span>
                            <span class="stat">ìš°ì •: ${result.scores.friendship}ì </span>
                            <span class="stat">ì—…ë¬´: ${result.scores.work}ì </span>
                            <span class="stat">ê¸¸ì´: ${result.messageLength}ì</span>
                        </div>
                        <div class="message-text">${result.message}</div>
                        <div style="margin-top: 10px; font-size: 0.9em; color: #888;">
                            <strong>ì¡°ì–¸:</strong> ${result.advice}
                        </div>
                    `, lengthStatus);
                }
            }
        }

        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        async function runAllTests() {
            console.log('ğŸŒŸ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            const compatData = await loadCompatibilityData();
            if (!compatData) {
                addResult('âŒ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨', 'compatibility-data.jsonì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // í†µê³„ ë³€ìˆ˜
            let totalTests = 0;
            let successTests = 0;
            let appropriateLength = 0;
            let tooShort = 0;
            let tooLong = 0;
            const lengths = [];

            // ëª¨ë“  ì¡°í•© í…ŒìŠ¤íŠ¸ (ìƒ˜í”Œë§)
            const testPairs = [
                [1,1], [1,4], [1,8], [2,5], [3,7],
                [4,9], [5,11], [6,12], [7,2], [8,10],
                [9,6], [10,3], [11,1], [12,8]
            ];

            for (const [z1, z2] of testPairs) {
                totalTests++;
                const result = await testCompatibility(z1, z2, compatData);

                if (!result.error) {
                    successTests++;
                    lengths.push(result.messageLength);

                    if (result.messageLength < 150) tooShort++;
                    else if (result.messageLength > 500) tooLong++;
                    else appropriateLength++;
                }
            }

            // ìš”ì•½ ì •ë³´ ìƒì„±
            const avgLength = lengths.length > 0 ? Math.round(lengths.reduce((a,b) => a+b, 0) / lengths.length) : 0;
            const minLength = lengths.length > 0 ? Math.min(...lengths) : 0;
            const maxLength = lengths.length > 0 ? Math.max(...lengths) : 0;

            addSummary(`
                <div class="stats">
                    <span class="stat">ì´ í…ŒìŠ¤íŠ¸: ${totalTests}ê°œ</span>
                    <span class="stat">ì„±ê³µ: ${successTests}ê°œ</span>
                    <span class="stat">ì‹¤íŒ¨: ${totalTests - successTests}ê°œ</span>
                </div>
                <div class="stats">
                    <span class="stat">ì ì ˆí•œ ê¸¸ì´: ${appropriateLength}ê°œ</span>
                    <span class="stat">ë„ˆë¬´ ì§§ìŒ: ${tooShort}ê°œ</span>
                    <span class="stat">ë„ˆë¬´ ê¸º: ${tooLong}ê°œ</span>
                </div>
                <div class="stats">
                    <span class="stat">ìµœì†Œ ê¸¸ì´: ${minLength}ì</span>
                    <span class="stat">í‰ê·  ê¸¸ì´: ${avgLength}ì</span>
                    <span class="stat">ìµœëŒ€ ê¸¸ì´: ${maxLength}ì</span>
                </div>
                <p><strong>ëª©í‘œ ë‹¬ì„±ë„:</strong> ${Math.round(appropriateLength / successTests * 100)}% (150-500ì ë²”ìœ„)</p>
            `);

            console.log(`ğŸ“Š í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ì„±ê³µë¥ : ${Math.round(successTests / totalTests * 100)}%`);
        }

        // ì´ˆê¸° ë©”ì‹œì§€
        console.log('ğŸŒŸ ë³„ìë¦¬ ê¶í•© ì§ì ‘ í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ');
        addResult('ğŸŒŸ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ', `
            <p>ì´ í˜ì´ì§€ëŠ” compatibility-data.json íŒŒì¼ì„ ì§ì ‘ ë¡œë“œí•˜ì—¬ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <p><strong>ê²€ì¦ ëª©í‘œ:</strong></p>
            <ul>
                <li>compat_message í•„ë“œê°€ ì œëŒ€ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸</li>
                <li>í…ìŠ¤íŠ¸ ê¸¸ì´ê°€ 150-500ì ë²”ìœ„ì— ìˆëŠ”ì§€ í™•ì¸</li>
                <li>ëª¨ë“  ë³„ìë¦¬ ì¡°í•©ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</li>
            </ul>
            <p>ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</p>
        `);

    </script>
</body>
</html>