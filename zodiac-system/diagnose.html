<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì§„ë‹¨</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        pre { background: #252526; padding: 15px; border-left: 3px solid #007acc; overflow-x: auto; }
    </style>
</head>
<body>
<h1>ğŸ” ë³„ìë¦¬ API ì§„ë‹¨</h1>
<div id="output"></div>

<script>
const output = document.getElementById('output');

function log(msg, type = 'info') {
    const div = document.createElement('div');
    div.className = type;
    div.textContent = msg;
    output.appendChild(div);
}

async function diagnose() {
    log('='.repeat(60));
    log('1ï¸âƒ£ í™˜ê²½ í™•ì¸');
    log('='.repeat(60));
    log(`í˜„ì¬ URL: ${window.location.href}`);
    log(`í”„ë¡œí† ì½œ: ${window.location.protocol}`);
    log('');

    log('='.repeat(60));
    log('2ï¸âƒ£ ì§ì ‘ Fetch í…ŒìŠ¤íŠ¸');
    log('='.repeat(60));

    const testUrl = 'api/fortune-data.json';
    log(`í…ŒìŠ¤íŠ¸ URL: ${testUrl}`);

    try {
        log('fetch ì‹œì‘...', 'warning');
        const start = Date.now();
        const response = await fetch(testUrl);
        const elapsed = Date.now() - start;

        log(`âœ… fetch ì„±ê³µ (${elapsed}ms)`, 'success');
        log(`Status: ${response.status}`);
        log(`OK: ${response.ok}`);
        log(`Content-Type: ${response.headers.get('content-type')}`);
        log('');

        log('JSON íŒŒì‹± ì‹œì‘...', 'warning');
        const parseStart = Date.now();
        const data = await response.json();
        const parseElapsed = Date.now() - parseStart;

        log(`âœ… JSON íŒŒì‹± ì„±ê³µ (${parseElapsed}ms)`, 'success');
        log(`daily í‚¤ ê°œìˆ˜: ${Object.keys(data.daily || {}).length}`);
        log(`2025-10-15 ì¡´ì¬: ${data.daily && data.daily['2025-10-15'] ? 'YES âœ…' : 'NO âŒ'}`);

        if (data.daily && data.daily['2025-10-15'] && data.daily['2025-10-15']['2']) {
            const loveMsg = data.daily['2025-10-15']['2'].fortunes.love;
            log('');
            log('='.repeat(60));
            log('3ï¸âƒ£ ìƒ˜í”Œ ë°ì´í„°');
            log('='.repeat(60));
            const pre = document.createElement('pre');
            pre.textContent = `í™©ì†Œìë¦¬ (2025-10-15) love ë©”ì‹œì§€:\n"${loveMsg}"\n\nê¸¸ì´: ${loveMsg.length}ì`;
            output.appendChild(pre);

            if (loveMsg.length >= 20) {
                log('âœ…âœ…âœ… ê°œì„ ëœ ë©”ì‹œì§€ í™•ì¸! âœ…âœ…âœ…', 'success');
            } else {
                log('âŒ í´ë°± ë©”ì‹œì§€ (ë„ˆë¬´ ì§§ìŒ)', 'error');
            }
        }

    } catch (e) {
        log(`âŒ ì—ëŸ¬ ë°œìƒ: ${e.message}`, 'error');
        log(`ì—ëŸ¬ íƒ€ì…: ${e.constructor.name}`, 'error');
        const pre = document.createElement('pre');
        pre.className = 'error';
        pre.textContent = e.stack;
        output.appendChild(pre);
    }

    log('');
    log('='.repeat(60));
    log('4ï¸âƒ£ API ì¸ìŠ¤í„´ìŠ¤ í™•ì¸');
    log('='.repeat(60));

    if (typeof zodiacAPI !== 'undefined') {
        log('âœ… zodiacAPI ì „ì—­ ë³€ìˆ˜ ì¡´ì¬', 'success');
        log(`basePath: ${zodiacAPI.basePath}`);
        log(`fortuneData: ${zodiacAPI.fortuneData ? 'EXISTS' : 'NULL'}`);

        if (zodiacAPI.fortuneData) {
            log(`daily í‚¤ ê°œìˆ˜: ${Object.keys(zodiacAPI.fortuneData.daily || {}).length}`);
        }
    } else {
        log('âŒ zodiacAPI ì „ì—­ ë³€ìˆ˜ ì—†ìŒ', 'error');
    }
}

// ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í›„ ì‹¤í–‰
const script = document.createElement('script');
script.src = 'api/zodiac-api-real.js?v=20251015-iife-path';
script.onload = () => {
    setTimeout(diagnose, 3000);  // API ë¡œë“œ ëŒ€ê¸°
};
script.onerror = (e) => {
    log('âŒ zodiac-api-real.js ë¡œë“œ ì‹¤íŒ¨', 'error');
};
document.head.appendChild(script);
</script>
</body>
</html>
