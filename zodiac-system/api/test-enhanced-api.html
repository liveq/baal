<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³„ìë¦¬ API í–¥ìƒ ë²„ì „ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        select, button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
        }
        select {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .result-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            min-height: 100px;
            font-family: 'Consolas', monospace;
            white-space: pre-wrap;
            max-height: 500px;
            overflow-y: auto;
        }
        .figure-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #ffd700;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .comparison-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
        .comparison-item h4 {
            margin: 0 0 10px 0;
            color: #ffd700;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin: 5px 0;
        }
        .status.loading {
            background: #f39c12;
        }
        .status.success {
            background: #27ae60;
        }
        .status.error {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ ë³„ìë¦¬ API í–¥ìƒ ë²„ì „ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ê¸°ë³¸ API vs í–¥ìƒëœ API ë¹„êµ -->
        <div class="test-section">
            <h2>ğŸ“Š ê¸°ë³¸ API vs í–¥ìƒëœ API ë¹„êµ í…ŒìŠ¤íŠ¸</h2>
            <div class="test-controls">
                <select id="zodiacSelect">
                    <option value="1">ì–‘ìë¦¬ â™ˆ</option>
                    <option value="2">í™©ì†Œìë¦¬ â™‰</option>
                    <option value="3">ìŒë‘¥ì´ìë¦¬ â™Š</option>
                    <option value="4">ê²Œìë¦¬ â™‹</option>
                    <option value="5">ì‚¬ììë¦¬ â™Œ</option>
                    <option value="6">ì²˜ë…€ìë¦¬ â™</option>
                    <option value="7">ì²œì¹­ìë¦¬ â™</option>
                    <option value="8">ì „ê°ˆìë¦¬ â™</option>
                    <option value="9">ì‚¬ìˆ˜ìë¦¬ â™</option>
                    <option value="10">ì—¼ì†Œìë¦¬ â™‘</option>
                    <option value="11">ë¬¼ë³‘ìë¦¬ â™’</option>
                    <option value="12">ë¬¼ê³ ê¸°ìë¦¬ â™“</option>
                </select>
                <button onclick="compareAPIs()">ë¹„êµ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                <button onclick="testMultipleZodiacs()">ì „ì²´ ë³„ìë¦¬ í…ŒìŠ¤íŠ¸</button>
            </div>
            
            <div id="comparisonResult"></div>
        </div>

        <!-- ì¸ë¬¼ ì„ íƒ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ‘‘ ì—­ì‚¬ì  ì¸ë¬¼ ì„ íƒ ë¡œì§ í…ŒìŠ¤íŠ¸</h2>
            <div class="test-controls">
                <button onclick="testFigureRotation()">ì¸ë¬¼ ë¡œí…Œì´ì…˜ í…ŒìŠ¤íŠ¸ (7ì¼)</button>
                <button onclick="testAllZodiacFigures()">ëª¨ë“  ë³„ìë¦¬ ì¸ë¬¼ í™•ì¸</button>
            </div>
            <div id="figureTestResult" class="result-box"></div>
        </div>

        <!-- ë©”ì‹œì§€ ìƒì„± í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ’¬ ë©”ì‹œì§€ ìƒì„± í’ˆì§ˆ í…ŒìŠ¤íŠ¸</h2>
            <div class="test-controls">
                <button onclick="testMessageVariety()">ë©”ì‹œì§€ ë‹¤ì–‘ì„± í…ŒìŠ¤íŠ¸</button>
                <button onclick="testCategoryMessages()">ì¹´í…Œê³ ë¦¬ë³„ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸</button>
            </div>
            <div id="messageTestResult" class="result-box"></div>
        </div>

        <!-- API ìƒíƒœ í™•ì¸ -->
        <div class="test-section">
            <h2>ğŸ”§ API ìƒíƒœ ë° ë¡œë”© í™•ì¸</h2>
            <div class="test-controls">
                <button onclick="checkAPIStatus()">API ìƒíƒœ í™•ì¸</button>
                <button onclick="testFallback()">í´ë°± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
            </div>
            <div id="statusResult" class="result-box"></div>
        </div>
    </div>

    <!-- API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="zodiac-api-real.js"></script>
    <script src="zodiac-api-enhanced-fixed.js"></script>
    
    <script>
        let testResults = {};

        function showStatus(elementId, message, type = 'loading') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<span class="status ${type}">${type === 'loading' ? 'â³' : type === 'success' ? 'âœ…' : 'âŒ'} ${message}</span>\n`;
        }

        function appendResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.innerHTML += content + '\n';
        }

        // ê¸°ë³¸ API vs í–¥ìƒëœ API ë¹„êµ
        async function compareAPIs() {
            const zodiacId = document.getElementById('zodiacSelect').value;
            const resultDiv = document.getElementById('comparisonResult');
            
            showStatus('comparisonResult', `ë³„ìë¦¬ ${zodiacId}ë²ˆ ë¹„êµ í…ŒìŠ¤íŠ¸ ì‹œì‘...`);
            
            try {
                // ê¸°ë³¸ API (zodiacAPI)
                const basicResult = await zodiacAPI.getDailyFortune(zodiacId);
                
                // í–¥ìƒëœ API (zodiacAPIEnhanced)
                const enhancedResult = await zodiacAPIEnhanced.getDailyFortuneEnhanced(zodiacId);
                
                resultDiv.innerHTML = `
                    <div class="comparison">
                        <div class="comparison-item">
                            <h4>ğŸ”„ ê¸°ë³¸ API ê²°ê³¼</h4>
                            <p><strong>Overall:</strong> ${basicResult.overall}</p>
                            <p><strong>Advice:</strong> ${basicResult.advice}</p>
                            <p><strong>Source:</strong> ${basicResult.source || 'basic'}</p>
                        </div>
                        <div class="comparison-item">
                            <h4>âœ¨ í–¥ìƒëœ API ê²°ê³¼</h4>
                            <p><strong>Overall:</strong> ${enhancedResult.overall}</p>
                            <p><strong>Advice:</strong> ${enhancedResult.advice}</p>
                            <p><strong>Source:</strong> ${enhancedResult.source}</p>
                            ${enhancedResult.historicalFigure ? `
                                <div class="figure-info">
                                    <p><strong>ğŸ‘‘ ì„ íƒëœ ì¸ë¬¼:</strong> ${enhancedResult.historicalFigure.name} (${enhancedResult.historicalFigure.period})</p>
                                    <p><strong>ğŸŒ êµ­ê°€:</strong> ${enhancedResult.historicalFigure.country}</p>
                                    <p><strong>ğŸ’­ ëª…ì–¸:</strong> "${enhancedResult.historicalFigure.quote}"</p>
                                </div>
                            ` : '<p>âš ï¸ ì—­ì‚¬ì  ì¸ë¬¼ ë°ì´í„° ì—†ìŒ</p>'}
                        </div>
                    </div>
                `;
                
                testResults[`zodiac_${zodiacId}`] = { basic: basicResult, enhanced: enhancedResult };
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status error">í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}</span>`;
            }
        }

        // ì¸ë¬¼ ë¡œí…Œì´ì…˜ í…ŒìŠ¤íŠ¸ (7ì¼ê°„)
        async function testFigureRotation() {
            const zodiacId = 1; // ì–‘ìë¦¬ë¡œ í…ŒìŠ¤íŠ¸
            showStatus('figureTestResult', '7ì¼ê°„ ì¸ë¬¼ ë¡œí…Œì´ì…˜ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            let results = 'ğŸ“… ì–‘ìë¦¬ - 7ì¼ê°„ ì„ íƒë˜ëŠ” ì¸ë¬¼ë“¤:\n\n';
            
            for (let i = 0; i < 7; i++) {
                const testDate = new Date();
                testDate.setDate(testDate.getDate() + i);
                
                const figure = zodiacAPIEnhanced.selectHistoricalFigure(zodiacId, testDate);
                
                if (figure) {
                    results += `Day ${i + 1} (${testDate.toLocaleDateString()}): ${figure.name} (${figure.period})\n`;
                    results += `  - í•µì‹¬ íŠ¹ì„±: ${figure.coreTraits.join(', ')}\n`;
                    results += `  - ëª…ì–¸: "${figure.famousQuote}"\n\n`;
                } else {
                    results += `Day ${i + 1}: âŒ ì¸ë¬¼ ë°ì´í„° ì—†ìŒ\n\n`;
                }
            }
            
            document.getElementById('figureTestResult').innerHTML = results;
        }

        // ëª¨ë“  ë³„ìë¦¬ ì¸ë¬¼ í™•ì¸
        async function testAllZodiacFigures() {
            showStatus('figureTestResult', 'ëª¨ë“  ë³„ìë¦¬ ì¸ë¬¼ ë°ì´í„° í™•ì¸ ì¤‘...');
            
            let results = 'ğŸŒŸ ê° ë³„ìë¦¬ë³„ ëŒ€í‘œ ì¸ë¬¼ë“¤:\n\n';
            
            for (let zodiacId = 1; zodiacId <= 12; zodiacId++) {
                const figure = zodiacAPIEnhanced.selectHistoricalFigure(zodiacId);
                const zodiacName = zodiacAPIEnhanced.zodiacSigns[zodiacId - 1].name;
                
                if (figure) {
                    results += `${zodiacName} (${zodiacId}): ${figure.name}\n`;
                    results += `  - ì‹œëŒ€: ${figure.period} (${figure.country})\n`;
                    results += `  - ì£¼ìš” ì—…ì : ${figure.achievements[0].split(' - ')[0]}\n\n`;
                } else {
                    results += `${zodiacName} (${zodiacId}): âŒ ë°ì´í„° ì—†ìŒ\n\n`;
                }
            }
            
            document.getElementById('figureTestResult').innerHTML = results;
        }

        // ë©”ì‹œì§€ ë‹¤ì–‘ì„± í…ŒìŠ¤íŠ¸
        async function testMessageVariety() {
            const zodiacId = 8; // ì „ê°ˆìë¦¬ë¡œ í…ŒìŠ¤íŠ¸
            showStatus('messageTestResult', 'ë©”ì‹œì§€ ë‹¤ì–‘ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            let results = 'ğŸ¯ ì „ê°ˆìë¦¬ - 5ë²ˆ ì—°ì† ìƒì„± ê²°ê³¼:\n\n';
            
            for (let i = 1; i <= 5; i++) {
                try {
                    const result = await zodiacAPIEnhanced.getDailyFortuneEnhanced(zodiacId);
                    results += `ìƒì„± ${i}:\n`;
                    results += `  Overall: ${result.overall}\n`;
                    results += `  Work: ${result.fortunes?.work || 'N/A'}\n`;
                    results += `  Love: ${result.fortunes?.love || 'N/A'}\n\n`;
                } catch (error) {
                    results += `ìƒì„± ${i}: âŒ ì˜¤ë¥˜ - ${error.message}\n\n`;
                }
            }
            
            document.getElementById('messageTestResult').innerHTML = results;
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸
        async function testCategoryMessages() {
            showStatus('messageTestResult', 'ì¹´í…Œê³ ë¦¬ë³„ ë©”ì‹œì§€ ìƒì„± í…ŒìŠ¤íŠ¸...');
            
            const zodiacId = 5; // ì‚¬ììë¦¬
            const figure = zodiacAPIEnhanced.selectHistoricalFigure(zodiacId);
            
            let results = `ğŸ¦ ì‚¬ììë¦¬ - ì„ íƒëœ ì¸ë¬¼: ${figure ? figure.name : 'ì—†ìŒ'}\n\n`;
            
            if (figure) {
                const categories = ['work', 'love', 'money', 'health'];
                
                results += 'ğŸ“ ì¹´í…Œê³ ë¦¬ë³„ ë©”ì‹œì§€ ìƒì„±:\n\n';
                
                for (const category of categories) {
                    for (let i = 1; i <= 3; i++) {
                        const message = zodiacAPIEnhanced.generateEnhancedMessage(category, figure, zodiacId);
                        results += `${category.toUpperCase()} ${i}: ${message || 'N/A'}\n`;
                    }
                    results += '\n';
                }
            } else {
                results += 'âŒ ì¸ë¬¼ ë°ì´í„°ê°€ ì—†ì–´ ë©”ì‹œì§€ ìƒì„± ë¶ˆê°€\n';
            }
            
            document.getElementById('messageTestResult').innerHTML = results;
        }

        // API ìƒíƒœ í™•ì¸
        async function checkAPIStatus() {
            showStatus('statusResult', 'API ìƒíƒœ í™•ì¸ ì¤‘...');
            
            let results = 'ğŸ” API ìƒíƒœ ì ê²€ ê²°ê³¼:\n\n';
            
            // 1. ë°ì´í„° ë¡œë”© ìƒíƒœ
            results += `ê¸°ë³¸ ìš´ì„¸ ë°ì´í„°: ${zodiacAPIEnhanced.fortuneData ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ'}\n`;
            results += `ì—­ì‚¬ì  ì¸ë¬¼ ë°ì´í„°: ${zodiacAPIEnhanced.historicalFigures ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ'}\n\n`;
            
            // 2. ë°ì´í„° í¬ê¸° ì •ë³´
            if (zodiacAPIEnhanced.fortuneData) {
                const dailyCount = Object.keys(zodiacAPIEnhanced.fortuneData.daily || {}).length;
                results += `ì¼ì¼ ìš´ì„¸ ë°ì´í„°: ${dailyCount}ì¼\n`;
            }
            
            if (zodiacAPIEnhanced.historicalFigures) {
                const figuresData = zodiacAPIEnhanced.historicalFigures.zodiacFigures;
                const totalFigures = Object.values(figuresData).reduce((sum, zodiac) => sum + (zodiac.figures?.length || 0), 0);
                results += `ì—­ì‚¬ì  ì¸ë¬¼: ${totalFigures}ëª…\n`;
                results += `ë³„ìë¦¬ë³„ ì¸ë¬¼ ë¶„í¬:\n`;
                
                Object.entries(figuresData).forEach(([key, data]) => {
                    results += `  - ${data.name}: ${data.figures?.length || 0}ëª…\n`;
                });
            }
            
            results += '\n';
            
            // 3. ë©”ì„œë“œ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
            const methods = ['getZodiacId', 'getZodiacByDate', 'getDailyFortune', 'getDailyFortuneEnhanced'];
            results += 'ğŸ”§ ë©”ì„œë“œ ì ‘ê·¼ì„±:\n';
            
            methods.forEach(method => {
                results += `  - ${method}: ${typeof zodiacAPIEnhanced[method] === 'function' ? 'âœ…' : 'âŒ'}\n`;
            });
            
            document.getElementById('statusResult').innerHTML = results;
        }

        // í´ë°± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function testFallback() {
            showStatus('statusResult', 'í´ë°± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì¤‘...');
            
            let results = 'ğŸ›¡ï¸ í´ë°± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸:\n\n';
            
            // 1. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë³„ìë¦¬ ID í…ŒìŠ¤íŠ¸
            try {
                const invalidResult = await zodiacAPIEnhanced.getDailyFortune(999);
                results += `ì˜ëª»ëœ ë³„ìë¦¬ ID (999): ${invalidResult ? 'âœ… í´ë°± ë™ì‘' : 'âŒ ì‹¤íŒ¨'}\n`;
            } catch (error) {
                results += `ì˜ëª»ëœ ë³„ìë¦¬ ID (999): âŒ ì˜ˆì™¸ ë°œìƒ - ${error.message}\n`;
            }
            
            // 2. ë°ì´í„° ì—†ëŠ” ìƒí™© ì‹œë®¬ë ˆì´ì…˜
            const originalData = zodiacAPIEnhanced.historicalFigures;
            zodiacAPIEnhanced.historicalFigures = null;
            
            try {
                const fallbackResult = await zodiacAPIEnhanced.getDailyFortuneEnhanced(1);
                results += `ì¸ë¬¼ ë°ì´í„° ì—†ìŒ: ${fallbackResult.source === 'base-fallback' ? 'âœ…' : 'âš ï¸'} (${fallbackResult.source})\n`;
            } catch (error) {
                results += `ì¸ë¬¼ ë°ì´í„° ì—†ìŒ: âŒ ì˜ˆì™¸ ë°œìƒ - ${error.message}\n`;
            }
            
            // ì›ë³µ
            zodiacAPIEnhanced.historicalFigures = originalData;
            
            results += '\nâœ… í´ë°± ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ';
            
            document.getElementById('statusResult').innerHTML = results;
        }

        // ì „ì²´ ë³„ìë¦¬ í…ŒìŠ¤íŠ¸
        async function testMultipleZodiacs() {
            showStatus('comparisonResult', 'ì „ì²´ ë³„ìë¦¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...');
            
            let results = 'ğŸŒŸ ì „ì²´ ë³„ìë¦¬ í–¥ìƒëœ API í…ŒìŠ¤íŠ¸:\n\n';
            
            for (let zodiacId = 1; zodiacId <= 12; zodiacId++) {
                try {
                    const result = await zodiacAPIEnhanced.getDailyFortuneEnhanced(zodiacId);
                    const zodiacName = zodiacAPIEnhanced.zodiacSigns[zodiacId - 1].name;
                    
                    results += `${zodiacName} (${zodiacId}):\n`;
                    results += `  - Source: ${result.source}\n`;
                    results += `  - ì¸ë¬¼: ${result.historicalFigure ? result.historicalFigure.name : 'ì—†ìŒ'}\n`;
                    results += `  - Overall: ${result.overall.substring(0, 50)}...\n\n`;
                } catch (error) {
                    results += `ë³„ìë¦¬ ${zodiacId}: âŒ ì˜¤ë¥˜ - ${error.message}\n\n`;
                }
            }
            
            document.getElementById('comparisonResult').innerHTML = `<div class="result-box">${results}</div>`;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ API ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - API í™•ì¸');
                console.log('Basic API:', typeof zodiacAPI);
                console.log('Enhanced API:', typeof zodiacAPIEnhanced);
                
                if (typeof zodiacAPIEnhanced === 'undefined') {
                    document.body.innerHTML = '<div style="text-align:center; padding:50px; color:red;"><h1>âŒ Enhanced API ë¡œë“œ ì‹¤íŒ¨</h1><p>zodiac-api-enhanced.js íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p></div>';
                }
            }, 1000);
        });
    </script>
</body>
</html>