<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced API Integration Test</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 8px;
            margin: 20px 0;
            padding: 20px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .result {
            background: #1e1e1e;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196f3; }
        
        .figure-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .figure-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .figure-details {
            font-size: 14px;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <h1>ğŸŒŸ Enhanced Zodiac API Integration Test</h1>
    <p>ì—­ì‚¬ì  ì¸ë¬¼ ë°ì´í„°ì™€ ê¸°ì¡´ ìš´ì„¸ ë°ì´í„°ì˜ í†µí•© í…ŒìŠ¤íŠ¸</p>

    <div class="test-section">
        <h2>ğŸ“Š API ë¡œë“œ ìƒíƒœ í™•ì¸</h2>
        <button class="test-button" onclick="checkAPIStatus()">API ìƒíƒœ í™•ì¸</button>
        <div id="api-status-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ­ ì¼ì¼ ìš´ì„¸ í…ŒìŠ¤íŠ¸ (ì—­ì‚¬ì  ì¸ë¬¼ í†µí•©)</h2>
        <p>ì—¬ëŸ¬ ë³„ìë¦¬ì˜ ì¼ì¼ ìš´ì„¸ë¥¼ í™•ì¸í•˜ì—¬ ì—­ì‚¬ì  ì¸ë¬¼ í†µí•©ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        
        <div>
            <button class="test-button" onclick="testZodiacFortune(1)">ì–‘ìë¦¬ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testZodiacFortune(2)">í™©ì†Œìë¦¬ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testZodiacFortune(5)">ì‚¬ììë¦¬ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="testZodiacFortune(12)">ë¬¼ê³ ê¸°ìë¦¬ í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <div id="daily-fortune-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ” ë°ì´í„° ì†ŒìŠ¤ ë¹„êµ</h2>
        <p>ê°™ì€ ë³„ìë¦¬ì— ëŒ€í•´ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•˜ì—¬ ì¼ê´€ì„±ê³¼ ì—­ì‚¬ì  ì¸ë¬¼ ì„ íƒ íŒ¨í„´ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>
        
        <button class="test-button" onclick="testDataConsistency()">ì¼ê´€ì„± í…ŒìŠ¤íŠ¸ (ì–‘ìë¦¬)</button>
        <div id="consistency-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ˆ ë©”ì‹œì§€ í’ˆì§ˆ ë¶„ì„</h2>
        <button class="test-button" onclick="analyzeMessageQuality()">ë©”ì‹œì§€ í’ˆì§ˆ ë¶„ì„</button>
        <div id="message-quality-result" class="result"></div>
    </div>

    <script src="api/zodiac-api-real.js"></script>
    <script>
        let testResults = [];

        async function checkAPIStatus() {
            const resultDiv = document.getElementById('api-status-result');
            resultDiv.innerHTML = 'ğŸ”„ API ìƒíƒœ í™•ì¸ ì¤‘...';

            try {
                // API ì¸ìŠ¤í„´ìŠ¤ í™•ì¸
                if (typeof zodiacAPI === 'undefined') {
                    throw new Error('zodiacAPI ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                let status = 'âœ… API ë¡œë“œ ìƒíƒœ:\n';
                status += `- zodiacAPI ì¸ìŠ¤í„´ìŠ¤: ${typeof zodiacAPI}\n`;
                status += `- í´ë˜ìŠ¤ëª…: ${zodiacAPI.constructor.name}\n`;
                
                // ë°ì´í„° ë¡œë“œ ìƒíƒœ í™•ì¸
                await new Promise(resolve => setTimeout(resolve, 2000)); // ë¡œë“œ ëŒ€ê¸°
                
                status += `- fortuneData: ${zodiacAPI.fortuneData ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ'}\n`;
                status += `- historicalFigures: ${zodiacAPI.historicalFigures ? 'âœ… ë¡œë“œë¨' : 'âŒ ì—†ìŒ'}\n`;
                
                if (zodiacAPI.historicalFigures && zodiacAPI.historicalFigures.zodiacFigures) {
                    const zodiacCount = Object.keys(zodiacAPI.historicalFigures.zodiacFigures).length;
                    status += `- ë³„ìë¦¬ ë°ì´í„° ìˆ˜: ${zodiacCount}ê°œ\n`;
                }

                if (zodiacAPI.fortuneData && zodiacAPI.fortuneData.daily) {
                    const dailyCount = Object.keys(zodiacAPI.fortuneData.daily).length;
                    status += `- ì¼ì¼ ìš´ì„¸ ë°ì´í„°: ${dailyCount}ì¼\n`;
                }

                resultDiv.innerHTML = status;
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}\n${error.stack}`;
                resultDiv.className = 'result error';
            }
        }

        async function testZodiacFortune(zodiacId) {
            const resultDiv = document.getElementById('daily-fortune-result');
            resultDiv.innerHTML = `ğŸ”„ ë³„ìë¦¬ ${zodiacId} ì¼ì¼ ìš´ì„¸ í…ŒìŠ¤íŠ¸ ì¤‘...`;

            try {
                const fortune = await zodiacAPI.getDailyFortune(zodiacId);
                
                let result = `ğŸŒŸ ë³„ìë¦¬ ${zodiacId} ì¼ì¼ ìš´ì„¸ ê²°ê³¼:\n`;
                result += `- ë‚ ì§œ: ${fortune.date}\n`;
                result += `- ë°ì´í„° ì†ŒìŠ¤: ${fortune.source}\n`;
                result += `- ì „ì²´ ë©”ì‹œì§€: ${fortune.overall}\n\n`;
                
                if (fortune.historicalFigure) {
                    result += `ğŸ­ ì—°ê´€ëœ ì—­ì‚¬ì  ì¸ë¬¼:\n`;
                    result += `- ì´ë¦„: ${fortune.historicalFigure.name}\n`;
                    result += `- ì‹œëŒ€: ${fortune.historicalFigure.period}\n`;
                    result += `- êµ­ê°€: ${fortune.historicalFigure.country}\n`;
                    result += `- ì£¼ìš” ì—…ì : ${fortune.historicalFigure.achievement || 'N/A'}\n\n`;
                }
                
                result += `ğŸ“Š ì ìˆ˜:\n`;
                if (fortune.scores) {
                    Object.entries(fortune.scores).forEach(([key, value]) => {
                        result += `- ${key}: ${value}ì \n`;
                    });
                }
                
                result += `\nğŸ’­ ì¹´í…Œê³ ë¦¬ë³„ ë©”ì‹œì§€:\n`;
                if (fortune.fortunes) {
                    Object.entries(fortune.fortunes).forEach(([key, value]) => {
                        result += `- ${key}: ${value}\n`;
                    });
                }

                result += `\nğŸ€ í–‰ìš´:\n`;
                if (fortune.lucky) {
                    Object.entries(fortune.lucky).forEach(([key, value]) => {
                        result += `- ${key}: ${value}\n`;
                    });
                }
                
                result += `\nğŸ’¡ ì¡°ì–¸: ${fortune.advice}`;

                resultDiv.innerHTML = result;
                resultDiv.className = 'result success';
                
                // ê²°ê³¼ ì €ì¥
                testResults.push({
                    zodiacId,
                    timestamp: new Date().toISOString(),
                    fortune
                });
                
            } catch (error) {
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}\n${error.stack}`;
                resultDiv.className = 'result error';
            }
        }

        async function testDataConsistency() {
            const resultDiv = document.getElementById('consistency-result');
            resultDiv.innerHTML = 'ğŸ”„ ë°ì´í„° ì¼ê´€ì„± í…ŒìŠ¤íŠ¸ ì¤‘...';

            try {
                const tests = [];
                // ê°™ì€ ë³„ìë¦¬ë¡œ 3ë²ˆ í…ŒìŠ¤íŠ¸
                for (let i = 0; i < 3; i++) {
                    const fortune = await zodiacAPI.getDailyFortune(1); // ì–‘ìë¦¬
                    tests.push(fortune);
                    await new Promise(resolve => setTimeout(resolve, 500));
                }

                let result = 'ğŸ” ì–‘ìë¦¬ ì¼ê´€ì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n\n';
                
                tests.forEach((test, index) => {
                    result += `í…ŒìŠ¤íŠ¸ ${index + 1}:\n`;
                    result += `- ë°ì´í„° ì†ŒìŠ¤: ${test.source}\n`;
                    result += `- ì—­ì‚¬ì  ì¸ë¬¼: ${test.historicalFigure ? test.historicalFigure.name : 'None'}\n`;
                    result += `- ì „ì²´ ë©”ì‹œì§€ ê¸¸ì´: ${test.overall.length}ì\n`;
                    result += `- ì¡°ì–¸ ë©”ì‹œì§€: ${test.advice.substring(0, 50)}...\n\n`;
                });

                // ì¼ê´€ì„± ì²´í¬
                const sources = tests.map(t => t.source);
                const figures = tests.map(t => t.historicalFigure?.name).filter(Boolean);
                
                result += 'ğŸ“Š ì¼ê´€ì„± ë¶„ì„:\n';
                result += `- ëª¨ë“  í…ŒìŠ¤íŠ¸ ì†ŒìŠ¤ ë™ì¼: ${new Set(sources).size === 1 ? 'âœ…' : 'âŒ'}\n`;
                result += `- ì—­ì‚¬ì  ì¸ë¬¼ ì„ íƒ: ${figures.length > 0 ? 'âœ…' : 'âŒ'} (${figures.length}/3)\n`;
                result += `- ê³ ìœ  ì¸ë¬¼ ìˆ˜: ${new Set(figures).size}ëª…\n`;

                if (figures.length > 0) {
                    result += `- ì„ íƒëœ ì¸ë¬¼ë“¤: ${[...new Set(figures)].join(', ')}\n`;
                }

                resultDiv.innerHTML = result;
                resultDiv.className = 'result info';
                
            } catch (error) {
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function analyzeMessageQuality() {
            const resultDiv = document.getElementById('message-quality-result');
            resultDiv.innerHTML = 'ğŸ”„ ë©”ì‹œì§€ í’ˆì§ˆ ë¶„ì„ ì¤‘...';

            try {
                const zodiacIds = [1, 5, 9, 12]; // ë‹¤ì–‘í•œ ì›ì†Œ í…ŒìŠ¤íŠ¸
                const results = [];
                
                for (const zodiacId of zodiacIds) {
                    const fortune = await zodiacAPI.getDailyFortune(zodiacId);
                    results.push({
                        zodiacId,
                        zodiacName: zodiacAPI.zodiacSigns[zodiacId - 1].name,
                        fortune
                    });
                }

                let analysis = 'ğŸ“ˆ ë©”ì‹œì§€ í’ˆì§ˆ ë¶„ì„ ê²°ê³¼:\n\n';
                
                results.forEach(({ zodiacId, zodiacName, fortune }) => {
                    analysis += `ğŸŒŸ ${zodiacName} (ID: ${zodiacId}):\n`;
                    analysis += `- ë°ì´í„° ì†ŒìŠ¤: ${fortune.source}\n`;
                    analysis += `- ì—­ì‚¬ì  ì¸ë¬¼: ${fortune.historicalFigure ? fortune.historicalFigure.name : 'None'}\n`;
                    
                    if (fortune.historicalFigure) {
                        analysis += `- ì¸ë¬¼ ì‹œëŒ€: ${fortune.historicalFigure.period}\n`;
                        analysis += `- ì£¼ìš” ì—…ì : ${fortune.historicalFigure.achievement ? fortune.historicalFigure.achievement.split(' - ')[0] : 'N/A'}\n`;
                    }
                    
                    analysis += `- ì „ì²´ ë©”ì‹œì§€ ê¸¸ì´: ${fortune.overall.length}ì\n`;
                    analysis += `- ì¡°ì–¸ ê¸¸ì´: ${fortune.advice.length}ì\n`;
                    
                    // ë©”ì‹œì§€ í’ˆì§ˆ ì ìˆ˜
                    let qualityScore = 0;
                    if (fortune.historicalFigure) qualityScore += 30;
                    if (fortune.overall.includes(fortune.historicalFigure?.name)) qualityScore += 20;
                    if (fortune.advice.includes(fortune.historicalFigure?.name)) qualityScore += 20;
                    if (fortune.overall.length > 30) qualityScore += 15;
                    if (fortune.advice.length > 50) qualityScore += 15;
                    
                    analysis += `- í’ˆì§ˆ ì ìˆ˜: ${qualityScore}/100\n\n`;
                });

                // ì „ì²´ í†µê³„
                const withFigures = results.filter(r => r.fortune.historicalFigure).length;
                const avgOverallLength = results.reduce((sum, r) => sum + r.fortune.overall.length, 0) / results.length;
                const avgAdviceLength = results.reduce((sum, r) => sum + r.fortune.advice.length, 0) / results.length;
                
                analysis += 'ğŸ“Š ì „ì²´ í†µê³„:\n';
                analysis += `- ì—­ì‚¬ì  ì¸ë¬¼ ì—°ê²°ë¥ : ${(withFigures/results.length*100).toFixed(1)}% (${withFigures}/${results.length})\n`;
                analysis += `- í‰ê·  ì „ì²´ ë©”ì‹œì§€ ê¸¸ì´: ${avgOverallLength.toFixed(1)}ì\n`;
                analysis += `- í‰ê·  ì¡°ì–¸ ê¸¸ì´: ${avgAdviceLength.toFixed(1)}ì\n`;
                
                // ë°ì´í„° ì†ŒìŠ¤ ë¶„í¬
                const sourceCounts = {};
                results.forEach(r => {
                    sourceCounts[r.fortune.source] = (sourceCounts[r.fortune.source] || 0) + 1;
                });
                
                analysis += '\nğŸ“‹ ë°ì´í„° ì†ŒìŠ¤ ë¶„í¬:\n';
                Object.entries(sourceCounts).forEach(([source, count]) => {
                    analysis += `- ${source}: ${count}íšŒ (${(count/results.length*100).toFixed(1)}%)\n`;
                });

                resultDiv.innerHTML = analysis;
                resultDiv.className = 'result info';
                
            } catch (error) {
                resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}\n${error.stack}`;
                resultDiv.className = 'result error';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ API ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            setTimeout(checkAPIStatus, 1000);
        });
    </script>
</body>
</html>