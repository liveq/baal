<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¶í•© ë°ì´í„° ì—°ë™ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #e2e3e5; border-color: #d6d8db; }
        .log { font-family: monospace; font-size: 12px; margin: 5px 0; padding: 5px; background-color: #f8f9fa; }
    </style>
</head>
<body>
    <h1>ë³„ìë¦¬ ê¶í•© ë°ì´í„° ì—°ë™ ê²€ì¦</h1>

    <h2>í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</h2>
    <div id="testResults"></div>

    <h2>ìƒì„¸ ë¡œê·¸</h2>
    <div id="detailLogs"></div>

    <script src="api/zodiac-api-real.js"></script>
    <script>
        async function runCompatibilityTests() {
            const resultsDiv = document.getElementById('testResults');
            const logsDiv = document.getElementById('detailLogs');

            const testCases = [
                { z1: 1, z2: 4, name: 'ì–‘ìë¦¬-ê²Œìë¦¬ (ë¬¸ì œ ì¡°í•©)' },
                { z1: 11, z2: 5, name: 'ë¬¼ë³‘ìë¦¬-ì‚¬ììë¦¬ (ì •ìƒ ì¡°í•©)' },
                { z1: 5, z2: 12, name: 'ì‚¬ììë¦¬-ë¬¼ê³ ê¸°ìë¦¬ (ê¸´ í…ìŠ¤íŠ¸)' },
                { z1: 1, z2: 1, name: 'ì–‘ìë¦¬-ì–‘ìë¦¬ (ê°™ì€ ë³„ìë¦¬)' }
            ];

            // ë¡œê·¸ ìºì¹˜ë¥¼ ìœ„í•œ console override
            const originalLog = console.log;
            console.log = function(...args) {
                originalLog.apply(console, args);
                const logDiv = document.createElement('div');
                logDiv.className = 'log';
                logDiv.textContent = args.join(' ');
                logsDiv.appendChild(logDiv);
            };

            for (const testCase of testCases) {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'test-result loading';
                resultDiv.innerHTML = `<h3>${testCase.name}</h3><p>í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...</p>`;
                resultsDiv.appendChild(resultDiv);

                try {
                    console.log(`\nğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œì‘: ${testCase.name}`);
                    const compatibility = await zodiacAPI.getCompatibility(testCase.z1, testCase.z2);

                    let success = true;
                    let errors = [];

                    // 1. ê¸°ë³¸ í•„ë“œ ê²€ì¦
                    if (!compatibility.description) {
                        errors.push('description í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤');
                        success = false;
                    }

                    // 2. ì ìˆ˜ ê²€ì¦
                    if (!compatibility.totalScore) {
                        errors.push('totalScoreê°€ ì—†ìŠµë‹ˆë‹¤');
                        success = false;
                    }

                    // 3. source ê²€ì¦ (database-compat-message ìš°ì„ )
                    if (compatibility.source !== 'database-compat-message') {
                        console.log(`âš ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë©”ì‹œì§€ê°€ ì•„ë‹Œ ${compatibility.source} ì‚¬ìš©ë¨`);
                    }

                    // 4. compat_message ë‚´ìš© í™•ì¸
                    if (compatibility.description && compatibility.description.length < 50) {
                        errors.push('descriptionì´ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤ (50ì ë¯¸ë§Œ)');
                        success = false;
                    }

                    // ê²°ê³¼ í‘œì‹œ
                    resultDiv.className = success ? 'test-result success' : 'test-result error';
                    resultDiv.innerHTML = `
                        <h3>${testCase.name}</h3>
                        <p><strong>ìƒíƒœ:</strong> ${success ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}</p>
                        <p><strong>ì´ì :</strong> ${compatibility.totalScore || 'N/A'}</p>
                        <p><strong>ë°ì´í„° ì†ŒìŠ¤:</strong> ${compatibility.source || 'N/A'}</p>
                        <p><strong>ì„¤ëª… ê¸¸ì´:</strong> ${compatibility.description ? compatibility.description.length : 0}ì</p>
                        <p><strong>ì„¤ëª… ë‚´ìš©:</strong> ${compatibility.description ? compatibility.description.substring(0, 100) + '...' : 'N/A'}</p>
                        ${errors.length > 0 ? `<p><strong>ì˜¤ë¥˜:</strong> ${errors.join(', ')}</p>` : ''}
                    `;

                    console.log(`âœ… ${testCase.name} í…ŒìŠ¤íŠ¸ ì™„ë£Œ`);
                    console.log(`   - ì´ì : ${compatibility.totalScore}`);
                    console.log(`   - ì†ŒìŠ¤: ${compatibility.source}`);
                    console.log(`   - ì„¤ëª…: ${compatibility.description ? compatibility.description.substring(0, 100) + '...' : 'N/A'}`);

                } catch (error) {
                    resultDiv.className = 'test-result error';
                    resultDiv.innerHTML = `
                        <h3>${testCase.name}</h3>
                        <p><strong>ìƒíƒœ:</strong> âŒ ì—ëŸ¬ ë°œìƒ</p>
                        <p><strong>ì—ëŸ¬:</strong> ${error.message}</p>
                    `;
                    console.log(`âŒ ${testCase.name} í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:`, error);
                }
            }

            console.log('\nğŸ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }

        // APIê°€ ë¡œë“œëœ í›„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.addEventListener('load', () => {
            setTimeout(runCompatibilityTests, 1000);
        });
    </script>
</body>
</html>