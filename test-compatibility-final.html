<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³„ìë¦¬ ê¶í•© í…ŒìŠ¤íŠ¸ - ìµœì¢… ê²€ì¦</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 20px;
            background-color: #1a1a2e;
            color: #fff;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #16213e;
            border-radius: 10px;
        }
        .test-result {
            background-color: #0f3460;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #e94560;
        }
        .success { border-left-color: #4CAF50; }
        .warning { border-left-color: #FF9800; }
        .error { border-left-color: #f44336; }
        .zodiac-names {
            font-weight: bold;
            color: #e94560;
        }
        .message-text {
            background-color: #0a1e2e;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-style: italic;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        .stat {
            background-color: #0a1e2e;
            padding: 5px 10px;
            border-radius: 5px;
        }
        button {
            background-color: #e94560;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #d73c56;
        }
        .log {
            background-color: #000;
            color: #0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ ë³„ìë¦¬ ê¶í•© í…ŒìŠ¤íŠ¸ - ìµœì¢… ê²€ì¦</h1>

        <div>
            <h2>ğŸ” í…ŒìŠ¤íŠ¸ í•­ëª©</h2>
            <button onclick="testCompatibilityDataAccess()">1. compatibility-data.json ì ‘ê·¼ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testSpecificCombinations()">2. íŠ¹ì • ì¡°í•© í…ŒìŠ¤íŠ¸</button>
            <button onclick="testTextLengths()">3. í…ìŠ¤íŠ¸ ê¸¸ì´ ê²€ì¦</button>
            <button onclick="testAllCombinations()">4. ì „ì²´ ì¡°í•© í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
        </div>

        <div id="results"></div>
        <div id="console-log" class="log"></div>
    </div>

    <!-- zodiac-api-real.js ë¡œë“œ -->
    <script src="zodiac-system/api/zodiac-api-real.js"></script>

    <script>
        // ì½˜ì†” ë¡œê·¸ ìº¡ì²˜
        const originalLog = console.log;
        const originalError = console.error;
        const logDiv = document.getElementById('console-log');

        function captureLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44336' : '#4CAF50';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            captureLog(args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            captureLog(args.join(' '), 'error');
        };

        const resultsDiv = document.getElementById('results');

        function addResult(title, content, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<h3>${title}</h3>${content}`;
            resultsDiv.appendChild(div);
        }

        function clearResults() {
            resultsDiv.innerHTML = '';
            logDiv.innerHTML = '';
        }

        // ë³„ìë¦¬ ì´ë¦„ ë§¤í•‘
        const zodiacNames = {
            1: 'ì–‘ìë¦¬', 2: 'í™©ì†Œìë¦¬', 3: 'ìŒë‘¥ì´ìë¦¬', 4: 'ê²Œìë¦¬',
            5: 'ì‚¬ììë¦¬', 6: 'ì²˜ë…€ìë¦¬', 7: 'ì²œì¹­ìë¦¬', 8: 'ì „ê°ˆìë¦¬',
            9: 'ì‚¬ìˆ˜ìë¦¬', 10: 'ì—¼ì†Œìë¦¬', 11: 'ë¬¼ë³‘ìë¦¬', 12: 'ë¬¼ê³ ê¸°ìë¦¬'
        };

        // 1. compatibility-data.json ì ‘ê·¼ í…ŒìŠ¤íŠ¸
        async function testCompatibilityDataAccess() {
            console.log('ğŸ” compatibility-data.json ì ‘ê·¼ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            try {
                const response = await fetch('zodiac-system/api/compatibility-data.json');
                const status = response.ok ? 'success' : 'error';

                if (response.ok) {
                    const data = await response.json();
                    const keys = Object.keys(data);

                    addResult('âœ… JSON íŒŒì¼ ì ‘ê·¼', `
                        <p><strong>ìƒíƒœ:</strong> ${response.status} (${response.statusText})</p>
                        <p><strong>ë°ì´í„° ê°œìˆ˜:</strong> ${keys.length}ê°œ</p>
                        <p><strong>ì²« ë²ˆì§¸ í‚¤:</strong> ${keys[0]}</p>
                        <p><strong>ìƒ˜í”Œ ë°ì´í„°:</strong></p>
                        <div class="message-text">${JSON.stringify(data[keys[0]], null, 2).substring(0, 200)}...</div>
                    `, status);
                } else {
                    addResult('âŒ JSON íŒŒì¼ ì ‘ê·¼ ì‹¤íŒ¨', `ìƒíƒœ: ${response.status}`, 'error');
                }
            } catch (error) {
                console.error('JSON ì ‘ê·¼ ì˜¤ë¥˜:', error);
                addResult('âŒ JSON íŒŒì¼ ì ‘ê·¼ ì˜¤ë¥˜', error.message, 'error');
            }
        }

        // 2. íŠ¹ì • ì¡°í•© í…ŒìŠ¤íŠ¸
        async function testSpecificCombinations() {
            console.log('ğŸ¯ íŠ¹ì • ì¡°í•© í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            const testCases = [
                {name: 'ì–‘ìë¦¬ - ê²Œìë¦¬', z1: 1, z2: 4, expected: 'ë¬¸ì œ ì¡°í•©'},
                {name: 'ì‚¬ììë¦¬ - ì‚¬ììë¦¬', z1: 5, z2: 5, expected: 'ë™ì¼ ë³„ìë¦¬'},
                {name: 'ì–‘ìë¦¬ - í™©ì†Œìë¦¬', z1: 1, z2: 2, expected: 'ì¼ë°˜ ì¡°í•©'},
                {name: 'ë¬¼ê³ ê¸°ìë¦¬ - ì–‘ìë¦¬', z1: 12, z2: 1, expected: 'ì—­ìˆœ ì¡°í•©'}
            ];

            for (const testCase of testCases) {
                try {
                    console.log(`í…ŒìŠ¤íŠ¸: ${testCase.name} (${testCase.z1}-${testCase.z2})`);

                    const result = await zodiacAPI.getCompatibility(testCase.z1, testCase.z2);
                    const messageLength = result.description ? result.description.length : 0;

                    const status = (messageLength >= 150 && messageLength <= 500) ? 'success' : 'warning';

                    addResult(`${testCase.name}`, `
                        <div class="zodiac-names">${zodiacNames[testCase.z1]} Ã— ${zodiacNames[testCase.z2]}</div>
                        <div class="stats">
                            <span class="stat">ì „ì²´: ${result.totalScore || result.score}ì </span>
                            <span class="stat">ê¸¸ì´: ${messageLength}ì</span>
                            <span class="stat">ì†ŒìŠ¤: ${result.source}</span>
                        </div>
                        <div class="message-text">${result.description || 'ë©”ì‹œì§€ ì—†ìŒ'}</div>
                    `, status);

                } catch (error) {
                    console.error(`${testCase.name} í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:`, error);
                    addResult(`âŒ ${testCase.name} ì‹¤íŒ¨`, error.message, 'error');
                }
            }
        }

        // 3. í…ìŠ¤íŠ¸ ê¸¸ì´ ê²€ì¦
        async function testTextLengths() {
            console.log('ğŸ“ í…ìŠ¤íŠ¸ ê¸¸ì´ ê²€ì¦ ì‹œì‘...');

            const testPairs = [
                [1, 4], [5, 5], [1, 8], [3, 7], [2, 11]
            ];

            const lengths = [];
            let tooShort = 0;
            let tooLong = 0;
            let appropriate = 0;

            for (const [z1, z2] of testPairs) {
                try {
                    const result = await zodiacAPI.getCompatibility(z1, z2);
                    const length = result.description ? result.description.length : 0;
                    lengths.push(length);

                    if (length < 150) tooShort++;
                    else if (length > 500) tooLong++;
                    else appropriate++;

                } catch (error) {
                    console.error(`ê¸¸ì´ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜ (${z1}-${z2}):`, error);
                }
            }

            const avgLength = lengths.length > 0 ? Math.round(lengths.reduce((a,b) => a+b, 0) / lengths.length) : 0;
            const minLength = lengths.length > 0 ? Math.min(...lengths) : 0;
            const maxLength = lengths.length > 0 ? Math.max(...lengths) : 0;

            const status = (tooShort === 0 && tooLong === 0) ? 'success' : 'warning';

            addResult('ğŸ“ í…ìŠ¤íŠ¸ ê¸¸ì´ ë¶„ì„', `
                <div class="stats">
                    <span class="stat">ì ì ˆ: ${appropriate}ê°œ</span>
                    <span class="stat">ë„ˆë¬´ ì§§ìŒ: ${tooShort}ê°œ</span>
                    <span class="stat">ë„ˆë¬´ ê¸º: ${tooLong}ê°œ</span>
                </div>
                <div class="stats">
                    <span class="stat">ìµœì†Œ: ${minLength}ì</span>
                    <span class="stat">í‰ê· : ${avgLength}ì</span>
                    <span class="stat">ìµœëŒ€: ${maxLength}ì</span>
                </div>
                <p><strong>ëª©í‘œ ë²”ìœ„:</strong> 150-500ì</p>
            `, status);
        }

        // 4. ì „ì²´ ì¡°í•© í…ŒìŠ¤íŠ¸ (ìƒ˜í”Œë§)
        async function testAllCombinations() {
            console.log('ğŸ” ì „ì²´ ì¡°í•© ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            const sampleCombinations = [
                [1,1], [1,6], [2,8], [3,9], [4,10],
                [5,11], [6,12], [7,2], [8,3], [9,4],
                [10,5], [11,6], [12,7]
            ];

            let successCount = 0;
            let errorCount = 0;
            const errors = [];

            for (const [z1, z2] of sampleCombinations) {
                try {
                    const result = await zodiacAPI.getCompatibility(z1, z2);

                    if (result.description && result.description.length > 0) {
                        successCount++;
                    } else {
                        errorCount++;
                        errors.push(`${z1}-${z2}: ë©”ì‹œì§€ ì—†ìŒ`);
                    }

                } catch (error) {
                    errorCount++;
                    errors.push(`${z1}-${z2}: ${error.message}`);
                }
            }

            const status = errorCount === 0 ? 'success' : 'warning';

            addResult('ğŸ” ì „ì²´ ì¡°í•© ìƒ˜í”Œ í…ŒìŠ¤íŠ¸', `
                <div class="stats">
                    <span class="stat">ì„±ê³µ: ${successCount}ê°œ</span>
                    <span class="stat">ì‹¤íŒ¨: ${errorCount}ê°œ</span>
                    <span class="stat">í…ŒìŠ¤íŠ¸: ${sampleCombinations.length}ê°œ</span>
                </div>
                ${errors.length > 0 ? `<div class="message-text">ì˜¤ë¥˜: ${errors.join(', ')}</div>` : ''}
            `, status);
        }

        // ì´ˆê¸° ë©”ì‹œì§€
        addResult('ğŸŒŸ ë³„ìë¦¬ ê¶í•© ì‹œìŠ¤í…œ ê²€ì¦', `
            <p>zodiac-api-real.jsê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p>ìœ„ì˜ ë²„íŠ¼ë“¤ì„ í´ë¦­í•˜ì—¬ ê° ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</p>
            <p><strong>ëª©í‘œ:</strong> compatibility-data.jsonì˜ compat_message í•„ë“œ ì‚¬ìš©</p>
            <p><strong>í…ìŠ¤íŠ¸ ê¸¸ì´:</strong> 150-500ì ë²”ìœ„</p>
        `);

    </script>
</body>
</html>